150:                // Ctrl+S (Save page)
4491:                        üì± 100% Offline: All data saved locally - works without internet</div>
4503:                        üîÑ Backup/Restore: Save all classes to file and restore on any device</div>
4530:                        üìú Auto History: Last 10 calculations saved - restore anytime</div>
4741:                    <button class="btn primary-btn" onclick="saveNotificationSettings()">Save Settings</button>
5018:                const savedState = sessionStorage.getItem('oauth_state');
5019:                if (state !== savedState) {
5026:                // Get saved code verifier for PKCE
5122:                // Save for later use
5277:                    // Save to localStorage
5308:                alert('üöß Google Sign-In is temporarily unavailable.\n\nWe are currently working on the database.\n\nPlease click "Continue as Guest" for now. Your data will be saved locally on this device.');
5339:                        if (!confirm('‚ö†Ô∏è Sync failed! Recent changes may not be saved to cloud.\n\nSign out anyway?')) {
5407:                const savedUser = localStorage.getItem('googleUser');
5412:                console.log('   savedUser:', savedUser ? 'exists' : 'null');
5414:                // PRIORITY 1: If we have a saved Google user, they're logged in
5415:                if (savedUser) {
5417:                        googleUser = JSON.parse(savedUser);
5428:                        console.error('Failed to parse savedUser:', e);
5496:                const savedUser = localStorage.getItem('googleUser');
5498:                if (!isGuest && savedUser && googleUser?.accessToken) {
5521:                const savedUser = localStorage.getItem('googleUser');
5523:                if (!isGuest && savedUser) {
5525:                    const user = JSON.parse(savedUser);
5569:                                <button class="btn primary-btn" onclick="saveProfileName()">üíæ Save</button>
5591:                                <button class="btn primary-btn" onclick="saveFirstLoginName()" style="padding: 14px 40px; font-size: 1.1rem;">
5602:                const savedName = localStorage.getItem('userProfileName') || '';
5608:                if (nameInput) nameInput.value = savedName;
5612:            function saveProfileName() {
5760:                    // We simply add it to the 'classes' object and saveToStorage
5770:                    // Save timetable arrangement if present
5775:                    saveToStorage();
5814:            function saveFirstLoginName() {
5950:                    saveToStorage();
6068:                    `üíæ <b>Save karna mat bhoolna:</b> Saare changes karne ke baad <b>Save Class</b> button zaroor dabao!`,
6069:                    `üìä <b>Attendance Track:</b> Save karne ke baad main screen pe subjects dikhenge - wahan se daily attendance mark karo!`,
6308:                        <button class="btn primary-btn" onclick="saveProfileName()">üíæ Save</button>
6330:                        <button class="btn primary-btn" onclick="saveFirstLoginName()" style="min-width: 150px;">Continue</button>
6349:                const savedUser = localStorage.getItem('googleUser');
6353:                if (!isGuest && savedUser) {
6355:                    const user = JSON.parse(savedUser);
6729:                    // Save sync timestamp
6826:            function saveToStorage() {
6832:                    console.error("Storage save failed:", e);
6834:                        alert("‚ö†Ô∏è Storage Full!\n\nYour browser cannot save more data. Please delete old classes or clear some space.");
6844:                // Restore saved calculation settings
6845:                const savedMinAttendance = localStorage.getItem('calcSettings_minAttendance');
6846:                const savedMinMedical = localStorage.getItem('calcSettings_minMedical');
6847:                const savedIsOverall = localStorage.getItem('calcSettings_isOverall');
6849:                if (savedMinAttendance) {
6851:                    if (minAttInput) minAttInput.value = savedMinAttendance;
6853:                if (savedMinMedical) {
6855:                    if (minMedInput) minMedInput.value = savedMinMedical;
6857:                if (savedIsOverall !== null) {
6859:                    if (overallCheckbox) overallCheckbox.checked = savedIsOverall === 'true';
6976:                // Theme saved as dark but body doesn't have class = broken
6977:                const savedTheme = localStorage.getItem('theme');
6978:                const themeBroken = savedTheme === 'dark' && !document.body.classList.contains('dark-mode');
7052:                    const savedTheme = localStorage.getItem('theme');
7053:                    if (savedTheme) {
7054:                        if (savedTheme === 'dark') {
7197:                                <li>Paste the entire JSON code into the text box below and click Save.</li>
7234:                        <button class="btn primary-btn" onclick="submitClassForm()">Save Class</button>
7285:                        <li><strong>Backup/Restore:</strong> Save all your classes to a file on your device and restore from it later. This is great for switching devices.</li>
7286:                        <li><strong>History:</strong> The app automatically saves your last 10 calculations. You can view or restore any of them from the history dropdown.</li>
7296:                    document.getElementById('dailyLogModal').innerHTML = `<div class="modal-content"><button class="modal-close" onclick="closeModal('dailyLogModal')">&times;</button><div class="modal-header"><h2>Daily Attendance Log</h2></div><div class="form-group"><label for="logDate">Current Date:</label><input type="date" id="logDate" onchange="populateDailyLog()"></div><div id="dailyLogSubjects"></div><div class="form-actions"><button class="btn primary-btn" onclick="saveDailyLog()">Save Log</button></div><p style="font-size: 0.8rem; text-align: center; margin-top: 15px;"><strong>Note:</strong> For past dates, 'Duty Leave (OD)' must be manually reflected by adding 1 to both 'Attended' and 'Held' values in the results.</p></div>`;
7297:                    document.getElementById('backupOptionsModal').innerHTML = `<div class="modal-content"><button class="modal-close" onclick="closeModal('backupOptionsModal')">&times;</button><div class="modal-header"><h2>üíæ Backup Data</h2><p>Choose how you want to save your backup.</p></div><div class="form-actions" style="flex-direction: column; gap: 15px;"><button class="btn primary-btn" onclick="performBackupDownload()" style="width: 100%;">‚¨áÔ∏è Download JSON File</button><button class="btn success-btn" onclick="performBackupShare()" style="width: 100%;">üì§ Share JSON File</button><button class="btn info-btn" onclick="performBackupCopy()" style="width: 100%;">üìã Copy JSON to Clipboard</button></div></div>`;
7333:                            <li>Paste it above and click <strong>Save</strong></li>
7338:                        <button class="btn primary-btn" onclick="saveAPISettings()">üíæ Save Settings</button>
7449:                    // Load saved theme on page load
7450:                    const savedTheme = localStorage.getItem('theme');
7451:                    console.log('Saved theme:', savedTheme);
7452:                    if (savedTheme === 'dark') {
7455:                        console.log('Applied saved dark mode');
7500:                // Save calculation settings to localStorage
7571:                    // Save last opened class
7969:                // Preserve current view mode (or use saved preference if currentView is not set)
7976:            // Load saved view preference or default to table (never default to graph)
7983:                // Save preference for cards/table only (never save graph as default)
8713:            async function saveNotificationSettings() {
8772:                    // Save per-class notification settings
8862:                    console.error('Save Notification Settings Error:', e);
8863:                    showToast('Failed to save settings: ' + e.message, 'error');
8893:                                <button class="btn primary-btn" onclick="saveAPISettings()">Save Settings</button>
8900:                // Load saved settings
9637:                        <p>Bunk it stores all your data <strong>locally on your device</strong>. Your attendance data, class information, and preferences are saved in your browser's local storage.</p>
9888:                        if (confirm(`‚ö†Ô∏è Class "${className}" already exists but has a different schedule.\n\nSave as "${dupResult.suggestedName}" instead?`)) {
9947:                saveToStorage();
9948:                alert(`Class "${className}" saved successfully!`);
10000:                        if (confirm(`‚ö†Ô∏è Class "${className}" already exists but has a different schedule.\n\nSave as "${dupResult.suggestedName}" instead?`)) {
10094:                    const verifyMessage = `‚ö†Ô∏è AI-generated JSON can sometimes have errors, especially in weekly schedules.\n\nDo you want to VERIFY the data before saving?\n\n‚úÖ Click OK to review in form view (recommended for AI-generated JSON)\n‚ùå Click Cancel to save directly (if copied from a classmate)`;
10121:                        alert('‚úÖ Data loaded into form.\n\nPlease VERIFY the Weekly Schedule for each subject, then click "Save Class".');
10123:                        // Save directly without verification
10127:                        // Save timetable arrangement
10132:                        saveToStorage();
10474:                    html += `<p style="color: var(--danger-color);"><strong>üõë Critical:</strong> Even with Medical Leave condonation, your projected max attendance (after planned leaves) is <strong>${activeStats.maxPossiblePercent.toFixed(1)}%</strong>, which is too low to be saved.</p>`;
11355:                const saved = localStorage.getItem(`period_times_${className}`);
11356:                return saved ? JSON.parse(saved) : null;
11359:            // Save period times to localStorage
11360:            function savePeriodTimes(className, times) {
11366:                const saved = localStorage.getItem(`timetable_arrangement_${className}`);
11367:                return saved ? JSON.parse(saved) : null;
11370:            // Save timetable arrangement to localStorage
11371:            function saveTimetableArrangement(className, arrangement) {
11433:                            <button class="btn primary-btn" onclick="savePeriodConfig()">üíæ Save Times</button>
11484:            // Save period configuration
11485:            function savePeriodConfig() {
11499:                savePeriodTimes(className, periodTimes);
11502:                alert('‚úÖ Period times saved successfully!');
11575:                // Get saved arrangement or create default
11594:                    saveTimetableArrangement(className, arrangement);
11815:                saveTimetableArrangement(className, arrangement);
11864:                // Save cleaned logs back
11873:            function saveDailyLog() {
11880:                    alert(`Cannot save attendance for ${dateStr}.\n\nThis date is a ${check.reason}.\nAll subjects should remain as "Default" (no attendance marked).`);
11881:                    return; // Don't save anything
11906:                alert('Log saved! Your future calculations will now reflect these changes.');
12508:                // 7. Save the document
12510:                doc.save(filename);
12601:                // 5. Add footer to the last page and save
12604:                doc.save(filename);
12622:                    saveToStorage();
12642:                saveToStorage();
12708:                        <button class="btn primary-btn" onclick="savePortalSetup()">üöÄ Start Portal Mode</button>
12717:            function savePortalSetup() {
12769:                saveToStorage();
12787:                    saveToStorage();
13047:                // Save class data
13103:                // Save to localStorage
13572:                const saveBtn = document.querySelector('#dailyLogModal .primary-btn');
13584:                    if (saveBtn) saveBtn.style.display = 'none';
13588:                if (saveBtn) saveBtn.style.display = 'block';
13830:                            <button class="btn primary-btn" onclick="saveCustomSchedulePeriodBased('${dateStr}')" style="flex: 1;">
13831:                                üíæ Save Schedule
13865:            function saveCustomSchedule(dateStr) {
13898:                // Save custom schedule (now as object with counts)
13906:                alert(`‚úÖ Custom schedule saved for ${dateStr} (${total} periods)`);
13909:            function saveCustomSchedulePeriodBased(dateStr) {
13936:                // Save in new format with _periods array AND subject counts for backward compatibility
13949:                alert(`‚úÖ Custom schedule saved for ${dateStr} (${totalClasses} classes)`);
14550:                    saveToStorage();
14552:                    // Save timetable arrangement if present, otherwise generate default
14870:                    // Use saved arrangement (array of objects with code, name, shortName)
15115:                                        // This ensures we save to the unique slot, not the generic subject
16442:                                // Store in global temp variable for save
17226:                                <li>Paste it above and click <strong>Save</strong></li>
17231:                            <button class="btn primary-btn" onclick="saveAPISettings()">üíæ Save Settings</button>
17237:                        // Load saved settings
17249:                    // Save API Settings
17250:                    function saveAPISettings() {
17256:                            showToast('API key saved successfully!', 'success');
